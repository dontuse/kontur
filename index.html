<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="stylesheet" href="static/publish/style.css"/>
</head>
<body class="b-page">
<header class="b-header b-wrap">
    <div class="b-header__container-1">
        <a class="b-logo" href="/"></a>
    </div>
    <div class="b-header__container-2">
        Контур. Тестовое задание.
    </div>
    <div class="b-header__container-3">

    </div>
</header>

<div class="b-wrap b-content">
    <div class="clearFix">
    <div style="float: left; width: 50%">
        <h2 class="b-title">1 инстанс:</h2>

        <div data-bind='component: {name:"konturCalculator" , params: calc1}'></div>
    </div>
    <div style="float: left; width: 50%">
        <h2 class="b-title">2 инстанс:</h2>

        <div data-bind='component: {name:"konturCalculator" , params: calc2}'></div>
    </div>
</div>









</div>

<footer class="b-footer b-wrap">
    © Andrey Bayandin
</footer>


<template id = "KonturComponent">
    <div class="b-kontur-c js-konur-calc" data-bind="sticky">
        <div class="b-kontur-c__head">
            <button data-bind='click: addItem' class="b-button b-kontur-c__add" type="button">Добавить cтрочку</button>
        </div>
        <div class="b-kontur-c__cy">Сумма, р.:</div>
        <div data-bind="foreach:data.elements">
            <div class="b-kontur-c__el">
                <div data-bind="css: { 'b-kontur-c__el-row_s_save': edit() }" class="b-kontur-c__el-row" >
                    <span data-bind="currency:val , click: $parents[0].startEdit , visible: !edit()" class="b-kontur-c__val"></span>
                    <input data-bind="value:val, enterKey:$parents[0].saveItem, visible: edit() " class="b-input b-kontur-c__nu-inp">
                    <button data-bind="click:$parents[0].saveItem , visible: edit()" class="b-button b-kontur-c__save" type="button">
                        Cохранить
                    </button>
                    <a data-bind="click:$parents[0].removeItem , visible: !edit()" class="b-kontur-c__remove" href="">Удалить</a>
                </div>
            </div>
        </div>
        <div class="b-kontur-c__total">
            <span class="b-kontur-c__sticky ">Итого:
                <b data-bind="currency:total" class="b-kontur-c__total-val"></b>
            </span>
        </div>
    </div>
</template>


<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="static/js/bower_components/knockoutjs/dist/knockout.debug.js"></script>

<script src="static/js/ko.bindings.extend.js"></script>
<script src="static/js/KonturComponentVM.js"></script>

<script src="static/js/sticky.js"></script>

<script>
    ko.bindingHandlers.sticky = {
        init: function(element, valueAccessor, allBindings, viewModel, bindingContext) {
            // This will be called when the binding is first applied to an element
            // Set up any initial state, event handlers, etc. here
            console.log('init');
            console.log(element);
            console.log(viewModel);
            console.log(bindingContext);
            sticky();
        },
        update: function(element, valueAccessor, allBindings, viewModel, bindingContext) {
            // This will be called once when the binding is first applied to an element,
            // and again whenever any observables/computeds that are accessed change
            // Update the DOM element based on the supplied values here.
            console.log('update');
        }
    };
</script>

<script>

    // app vm
    vm = function() {
        var self = this;

        self.calc1 =  {
            elements: ko.observableArray([
                {
                    val: ko.observable(11782),
                    edit: ko.observable(false)
                },
                {
                    val: ko.observable(3678),
                    edit: ko.observable(false)
                },
                {
                    val: ko.observable(678),
                    edit: ko.observable(false)
                },
                {
                    val: ko.observable(-5423),
                    edit: ko.observable(false)
                }
            ])
        };


        self.calc2 =  {
            elements: ko.observableArray([])
        };
    };

    $(function(){
        ko.applyBindings(new vm());

    });

    $(window).load(function() {


       // setTimeout(sticky, 3000);
    });
</script>





</body>
</html>